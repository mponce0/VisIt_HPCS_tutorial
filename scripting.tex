% http://www.visitusers.org/index.php?title=VisIt-tutorial-Python-scripting
% http://www.visitusers.org/index.php?title=VisIt-tutorial-Advanced-scripting

\defverbatim[colored]\guiless{
  \begin{lstlisting}[language=bash,basicstyle=\ttfamily,keywordstyle=\color{red}]
    $ /path/to/VisIt -nowin -cli -s script.py
  \end{lstlisting}
}

\begin{frame}{Python scripting in VisIt}{}
  \footnotesize{
    \begin{itemize}\setlength{\itemsep}{3mm}
    \item You can run VisIt Python scripts without the GUI from the command line (analogue of ParaView's
      'pvbatch')\guiless
    \item VisIt has a built-in Python 2.7 shell through Controls \ra Launch CLI. It'll start VisIt's
      Python interpreter in a terminal and attach it to the running VisIt session on a specific port on
      your laptop with a one-time security key
    \item Alternatively, Controls \ra Command provides a text editor with Python syntax highlighting and an
      Execute button that tells VisIt to execute the script
    \item Also, Controls \ra Command window lets you record your GUI actions into Python code that you can
      use in your scripts (similar to ParaView's Trace Tool)
    \item In addition, can use Python in Controls \ra Expressions \ra Python Expression Editor (similar to
      the Programmable filter in ParaView)
    \item In addition, can use Python in Controls \ra Query \ra Python Query Editor
    \end{itemize}}
\end{frame}

\defverbatim[colored]\drawPseudoColor{
  \begin{lstlisting}[language=python,basicstyle=\ttfamily,keywordstyle=\color{red}]
    AddPlot("Pseudocolor", "density")
    DrawPlots()
  \end{lstlisting}
}

\begin{frame}{Adding plots (typing in interactive shell)}
  Starting from scratch, load \texttt{sineEnvelope.nc}, start Python shell Controls \ra Launch CLI, and
  type in the following commands:\drawPseudoColor
  \pause
  \begin{itemize}\setlength{\itemsep}{3mm}
  \item Each plot in VisIt has a number of attributes that control the appearance of the plot
  \item To access them, first create a \emph{plot attributes object} by calling a function
    PlotNameAttributes, e.g., PseudocolorAttributes(), or VolumeAttributes()
  \item If changing attributes, pass the object to the SetPlotOptions()
  \item If setting new defaults, pass the object to SetDefaultPlotOptions()
  \end{itemize}
\end{frame}

\defverbatim[colored]\setMinMax{
  \begin{lstlisting}[language=python,basicstyle=\ttfamily,keywordstyle=\color{red}]
    p = PseudocolorAttributes()
    p   # will print out all attributes
    p.min, p.max = 1, 1.1   # colour map range
    p.minFlag, p.maxFlag = 1, 1   # turn it on
    SetPlotOptions(p) # set active plot attributes
    help(SetPlotOptions)
  \end{lstlisting}
}

\defverbatim[colored]\cancelMinMax{
  \begin{lstlisting}[language=python,basicstyle=\ttfamily,keywordstyle=\color{red}]
    p.minFlag, p.maxFlag = 0,0   # turn it off
    SetPlotOptions(p)
  \end{lstlisting}
}

\defverbatim[colored]\greens{
  \begin{lstlisting}[language=python,basicstyle=\ttfamily,keywordstyle=\color{red}]
    p.colorTableName = "Greens" # new colour map
    SetPlotOptions(p)
  \end{lstlisting}
}

\begin{frame}{Probing and setting plot attributes (interactive shell)}
  Add the following commands:
  \setMinMax
  \pause
  Revert to the original colour map range:
  \cancelMinMax
  \pause
  Pick a different colour map:
  \greens
\end{frame}

\defverbatim[colored]\runScript{
  \begin{lstlisting}[language=python,basicstyle=\scriptsize,keywordstyle=\color{red}]
    # import os
    # os.getcwd()
    # can use relative or absolute paths
    os.chdir('/Users/razoumov/Documents/teaching/visitWorkshop/scripts')
    # os.chdir("C:\Users\Josh\Desktop\20130216")   # Windows example
    Source('scriptName.py')
  \end{lstlisting}
}

\begin{frame}{Running scriptName.py from inside GUI}
  \begin{itemize}\setlength{\itemsep}{3mm}
  \item Option 1: paste the code into Controls \ra Command window and click Execute
  \item Option 2: inside the shell type \runScript
  \end{itemize}
\end{frame}

\begin{frame}{Setting attributes before drawing}
  Now let's start from scratch (\texttt{sineEnvelope.nc} loaded), set an attribute, and draw a plot:
  \lstinputlisting[language=python,showstringspaces=false,
    basicstyle=\scriptsize,keywordstyle=\color{red}]{scripts/scratch.py}
\end{frame}

\begin{frame}{Scripting an operator}
  With \texttt{sineEnvelope.nc} loaded, run the following:
  \lstinputlisting[language=python,showstringspaces=false,
    basicstyle=\scriptsize,keywordstyle=\color{red}]{scripts/addOperator.py}
  \pause\bigskip
  {\small Now let's produce 3 single-isosurface plots at density = 0.6, 1.0, 1.4, respectively:}
  \lstinputlisting[language=python,showstringspaces=false,
    basicstyle=\scriptsize,keywordstyle=\color{red}]{scripts/threeSurfaces.py}
\end{frame}

\defverbatim[colored]\writeToDisk{
  \begin{lstlisting}[language=python,basicstyle=\scriptsize,keywordstyle=\color{red}]
s = SaveWindowAttributes()
s.format = s.PNG
s.fileName = 'someName'
s.outputToCurrentDirectory = 0   # for some reason this is 'yes'
s.outputDirectory = "/path/to/directory"
SetSaveWindowAttributes(s)
...
build and display a plot
...
name = SaveWindow()   # returns the name of the file it wrote
  \end{lstlisting}
}

\begin{frame}{Saving images to disk}
  \writeToDisk\pause
  Now let's save the three surfaces to disk:
  \lstinputlisting[language=python,showstringspaces=false,
    basicstyle=\scriptsize,keywordstyle=\color{red}]{scripts/saveSurfaces.py}
\end{frame}

\begin{frame}{Animating camera position: create a plot}
  With \texttt{sineEnvelope.nc} loaded, draw a single isosurface at density=0.3 in green:
  \lstinputlisting[language=python,showstringspaces=false,
    basicstyle=\footnotesize,keywordstyle=\color{red}]{scripts/oneSurface.py}
    \pause
  \lstinputlisting[language=python,showstringspaces=false,
    basicstyle=\scriptsize,keywordstyle=\color{red}]{scripts/printView.py}
\end{frame}

\begin{frame}{Animating camera position: set a view by hand}
  Create a view by hand by explicitly setting the important attributes:
  \lstinputlisting[language=python,showstringspaces=false,
    basicstyle=\scriptsize,keywordstyle=\color{red}]{scripts/setControlPoint.py}
\end{frame}

\begin{frame}{Animating camera position: rotate around the vertical axis}
  \lstinputlisting[language=python,showstringspaces=false,
    basicstyle=\footnotesize,keywordstyle=\color{red}]{scripts/rotateAroundVertical.py}
\end{frame}

\begin{frame}{Animating camera position: fly into the volume and out}
  \lstinputlisting[language=python,showstringspaces=false,
    basicstyle=\footnotesize,keywordstyle=\color{red}]{scripts/flyInOut.py}
\end{frame}

\begin{frame}{Animating camera position: animate the perspective angle}
  \lstinputlisting[language=python,showstringspaces=false,
    basicstyle=\footnotesize,keywordstyle=\color{red}]{scripts/perspective.py}
\end{frame}

\begin{frame}{Camera animation: interpolating between control points}
  First, define a function to copy all attributes from one control point to another
  \lstinputlisting[language=python,showstringspaces=false,
    basicstyle=\footnotesize,keywordstyle=\color{red}]{scripts/copyView.py}
\end{frame}

\begin{frame}{Camera animation: interpolating between control points}
  Next, set three new control points, based on c0
  \lstinputlisting[language=python,showstringspaces=false,
    basicstyle=\footnotesize,keywordstyle=\color{red}]{scripts/threeControlPoints.py}
\end{frame}

\begin{frame}{Camera animation: interpolating between control points}
  Finally, interpolate between the control points with a small step
  \lstinputlisting[language=python,showstringspaces=false,
    basicstyle=\footnotesize,keywordstyle=\color{red}]{scripts/interpolate.py}
\end{frame}

\begin{frame}{Animating an operator: no animation yet}
  \lstinputlisting[language=python,showstringspaces=false,
    basicstyle=\scriptsize,keywordstyle=\color{red}]{scripts/clipStatic.py}
\end{frame}

\begin{frame}{Animating an operator: exercise}
  \qquad Try to do the following:\bigskip
  \begin{enumerate}\setlength{\itemsep}{3mm}
  \item Modify the previous slide's script to animate the clip plane through the volume from z=0 to z=1
  \item Write each image to disk as PNG
  \item Use a third-party tool to merge these into a movie
  \end{enumerate}
\end{frame}

\defverbatim[colored]\outIdentical{
  \begin{lstlisting}[language=python,basicstyle=\scriptsize,keywordstyle=\color{red}]
    density -- Min = 0.0194448 (node 323832 at coord <32, 38, 32>)
    density -- Max = 1.99497 (node 394939 at coord <39, 49, 39>)
    (0.019444825127720833, 1.9949746131896973)
  \end{lstlisting}
}

\begin{frame}{Scripting queries: pseudocolor}
  Most queries require an active non-hidden plot ... so, what do they query?
  \lstinputlisting[language=python,showstringspaces=false,
    basicstyle=\scriptsize,keywordstyle=\color{red}]{scripts/queryPseudocolor.py}
  \begin{block}{}{}\vspace{-3mm}\outIdentical\vspace{-3mm}\end{block}
\end{frame}

\begin{frame}{Scripting queries: contour}
  \lstinputlisting[language=python,showstringspaces=false,
    basicstyle=\scriptsize,keywordstyle=\color{red}]{scripts/queryContour.py}
  \pause
  Produces exactly the same query output!\\
  Why require a plot when we run a query not on the plot but on the original data?...
\end{frame}

\begin{frame}{Automating data analysis}
\end{frame}

\begin{frame}{Recording GUI actions to python scripts}
\end{frame}

\begin{frame}{Simple script}
\end{frame}
\begin{frame}{Simple script}
\end{frame}
\begin{frame}{Simple script}
\end{frame}
\begin{frame}{Simple script}
\end{frame}
\begin{frame}{Simple script}
\end{frame}
\begin{frame}{Simple script}
\end{frame}
\begin{frame}{Simple script}
\end{frame}
\begin{frame}{Simple script}
\end{frame}
\begin{frame}{Simple script}
\end{frame}
\begin{frame}{Simple script}
\end{frame}
\begin{frame}{Simple script}
\end{frame}
\begin{frame}{Simple script}
\end{frame}
